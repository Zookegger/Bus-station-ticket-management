@* @model Bus_Station_Ticket_Management.Models.Seat *@

@* @{ *@
@*     Layout = "~/Views/Shared/_Layout.cshtml"; *@
@* } *@

@* <div class="container mt-4"> *@
@*     <div class="row"> *@
@*         <!-- Phần sơ đồ ghế --> *@
@*         <div class="col-md-8"> *@
@*             <h2>Chọn ghế</h2> *@
@*             <div class="mb-3"> *@
@*                 <label class="form-label">Thông tin xe</label> *@
@*                 <div class="seat-legend-box"> *@
@*                     <span class="seat-legend booked">Đã bán</span> *@
@*                     <span class="seat-legend available">Còn trống</span> *@
@*                     <span class="seat-legend selected">Đang chọn</span> *@
@*                 </div> *@
@*             </div> *@

@*             <form asp-action="BookSeats" method="post" id="seatForm"> *@
@*                 <input type="hidden" asp-for="Id" /> *@
@*                 <input type="hidden" asp-for="VehicleId" /> *@
@*                 <div class="mb-3"> *@
@*                     <label class="form-label">Số lượng vé muốn mua:</label> *@
@*                     <input type="number" name="numberOfTickets" id="numberOfTickets" class="form-control" min="1" max="@Model.Seats.Count(s => !s.IsBooked)" required /> *@
@*                 </div> *@

@*                 <div class="mb-3"> *@
@*                     @if (Model.BusType == "Sleeper") *@
@*                     { *@
@*                         <div class="seat-map"> *@
@*                             <h4>Tầng dưới</h4> *@
@*                             <div class="seat-grid"> *@
@*                                 @for (int hang = 1; hang <= 8; hang++) *@
@*                                 { *@
@*                                     <div class="seat-row"> *@
@*                                         @for (int cot = 1; cot <= 3; cot++) *@
@*                                         { *@
@*                                             if (cot == 2) *@
@*                                             { *@
@*                                                 <div class="seat aisle"></div> *@
@*                                             } *@
@*                                             else *@
@*                                             { *@
@*                                                 var seat = Model.Seats.FirstOrDefault(s => s.Floor == 0 && s.Hang == hang && s.Cot == (cot == 1 ? 1 : 3)); *@
@*                                                 if (seat != null) *@
@*                                                 { *@
@*                                                     <div class="seat @(seat.IsBooked ? "booked" : "available")" data-seat-id="@seat.Id"> *@
@*                                                         @seat.SeatNumber *@
@*                                                     </div> *@
@*                                                 } *@
@*                                                 else *@
@*                                                 { *@
@*                                                     <div class="seat empty"></div> *@
@*                                                 } *@
@*                                             } *@
@*                                         } *@
@*                                     </div> *@
@*                                 } *@
@*                             </div> *@

@*                             <h4>Tầng trên</h4> *@
@*                             <div class="seat-grid"> *@
@*                                 @for (int hang = 1; hang <= 9; hang++) *@
@*                                 { *@
@*                                     <div class="seat-row"> *@
@*                                         @for (int cot = 1; cot <= 3; cot++) *@
@*                                         { *@
@*                                             if (cot == 2) *@
@*                                             { *@
@*                                                 <div class="seat aisle"></div> *@
@*                                             } *@
@*                                             else *@
@*                                             { *@
@*                                                 var seat = Model.Seats.FirstOrDefault(s => s.Floor == 1 && s.Hang == hang && s.Cot == (cot == 1 ? 1 : 3)); *@
@*                                                 if (seat != null) *@
@*                                                 { *@
@*                                                     <div class="seat @(seat.IsBooked ? "booked" : "available")" data-seat-id="@seat.Id"> *@
@*                                                         @seat.SeatNumber *@
@*                                                     </div> *@
@*                                                 } *@
@*                                                 else *@
@*                                                 { *@
@*                                                     <div class="seat empty"></div> *@
@*                                                 } *@
@*                                             } *@
@*                                         } *@
@*                                     </div> *@
@*                                 } *@
@*                             </div> *@
@*                         </div> *@
@*                     } *@
@*                     else if (Model.BusType == "Limousine") *@
@*                     { *@
@*                         <div class="seat-map"> *@
@*                             <h4>Sơ đồ ghế Limousine Solati 9 chỗ</h4> *@
@*                             <div class="seat-grid"> *@
@*                                 @for (int hang = 1; hang <= 3; hang++) *@
@*                                 { *@
@*                                     <div class="seat-row"> *@
@*                                         @for (int cot = 1; cot <= 3; cot++) *@
@*                                         { *@
@*                                             var seat = Model.Seats.FirstOrDefault(s => s.Hang == hang && s.Cot == cot); *@
@*                                             if (seat != null) *@
@*                                             { *@
@*                                                 <div class="seat @(seat.IsBooked ? "booked" : "available")" data-seat-id="@seat.Id"> *@
@*                                                     @seat.SeatNumber *@
@*                                                 </div> *@
@*                                             } *@
@*                                             else *@
@*                                             { *@
@*                                                 <div class="seat empty"></div> *@
@*                                             } *@
@*                                         } *@
@*                                     </div> *@
@*                                 } *@
@*                             </div> *@
@*                         </div> *@
@*                     } *@
@*                     else *@
@*                     { *@
@*                         <p class="text-danger">Loại xe không được hỗ trợ.</p> *@
@*                     } *@
@*                     <input type="hidden" name="selectedSeatIds" id="selectedSeatIds" /> *@
@*                 </div> *@

@*                 <div class="mb-3"> *@
@*                     <label class="form-label">Thông tin khách hàng</label> *@
@*                     <p>Chưa có thông tin khách hàng. Vui lòng nhập thông tin sau khi chọn ghế.</p> *@
@*                 </div> *@

@*                 <div class="mb-3"> *@
@*                     <label class="form-label">Điều khoản & Lưu ý</label> *@
@*                     <p>Vui lòng kiểm tra kỹ thông tin trước khi đặt vé. Vé đã đặt không thể hoàn trả.</p> *@
@*                 </div> *@

@*                 <button type="submit" class="btn btn-primary">Đặt vé</button> *@
@*             </form> *@
@*         </div> *@

@*         <!-- Phần thông tin lượt đi --> *@
@*         <div class="col-md-4"> *@
@*             <div class="card"> *@
@*                 <div class="card-body"> *@
@*                     <h5 class="card-title">Thông tin lượt đi</h5> *@
@*                     <p><strong>Tuyến xe:</strong> @Model.TripDeparture - @Model.TripDestination</p> *@
@*                     <p><strong>Thời gian xuất bến:</strong> @Model.DepartureTime.ToString("HH:mm dd/MM/yyyy")</p> *@
@*                     <p><strong>Điểm đón:</strong> @Model.PickUpPoint</p> *@
@*                     <p><strong>Điểm trả:</strong> @Model.DropOffPoint</p> *@
@*                     <p><strong>Biển số xe:</strong> @Model.LicensePlate</p> *@
@*                     <p><strong>Số lượng ghế:</strong> <span id="selectedSeatCount">0</span> ghế</p> *@
@*                     <p><strong>Số ghế:</strong> <span id="selectedSeats"></span></p> *@
@*                     <p><strong>Tổng tiền lượt đi:</strong> <span id="totalPrice">0đ</span></p> *@
@*                     <hr /> *@
@*                     <h5 class="card-title">Chi tiết giá</h5> *@
@*                     <p><strong>Giá vé lượt đi:</strong> <span id="ticketPrice">@Model.Price.ToString("N0")</span>đ</p> *@
@*                     <p><strong>Phí thanh toán:</strong> 0đ</p> *@
@*                     <hr /> *@
@*                     <h5 class="card-title">Tổng tiền</h5> *@
@*                     <p><strong><span id="finalTotalPrice">0đ</span></strong></p> *@
@*                 </div> *@
@*             </div> *@
@*         </div> *@
@*     </div> *@
@* </div> *@

@* @if (TempData["Error"] != null) *@
@* { *@
@*     <div class="alert alert-danger">@TempData["Error"]</div> *@
@* } *@
@* @if (TempData["Success"] != null) *@
@* { *@
@*     <div class="alert alert-success">@TempData["Success"]</div> *@
@* } *@

@* @section Scripts { *@
@*     <partial name="_ValidationScriptsPartial" /> *@
@*     <script> *@
@*         $(document).ready(function () { *@
@*             const maxSeats = @Model.Seats.Count(s => !s.IsBooked); *@
@*             let selectedSeats = []; *@
@*             const pricePerSeat = @Model.Price; *@

@*             $('.seat.available').click(function () { *@
@*                 const seatId = $(this).data('seat-id'); *@
@*                 const seatNumber = $(this).text().trim(); *@

@*                 if ($(this).hasClass('selected')) { *@
@*                     $(this).removeClass('selected'); *@
@*                     selectedSeats = selectedSeats.filter(s => s.id !== seatId); *@
@*                 } else if (selectedSeats.length < $('#numberOfTickets').val()) { *@
@*                     $(this).addClass('selected'); *@
@*                     selectedSeats.push({ id: seatId, number: seatNumber }); *@
@*                 } else { *@
@*                     alert('Bạn đã chọn đủ số ghế theo số lượng vé!'); *@
@*                     return; *@
@*                 } *@

@*                 // Cập nhật thông tin động *@
@*                 $('#selectedSeatIds').val(selectedSeats.map(s => s.id).join(',')); *@
@*                 $('#selectedSeatCount').text(selectedSeats.length); *@
@*                 $('#selectedSeats').text(selectedSeats.map(s => s.number).join(', ')); *@
@*                 const total = selectedSeats.length * pricePerSeat; *@
@*                 $('#totalPrice').text(total.toLocaleString('vi-VN') + 'đ'); *@
@*                 $('#ticketPrice').text(total.toLocaleString('vi-VN')); *@
@*                 $('#finalTotalPrice').text(total.toLocaleString('vi-VN') + 'đ'); *@
@*             }); *@

@*             $('#numberOfTickets').change(function () { *@
@*                 const numTickets = parseInt($(this).val()); *@
@*                 if (numTickets > maxSeats) { *@
@*                     alert('Số lượng vé vượt quá số ghế trống!'); *@
@*                     $(this).val(maxSeats); *@
@*                 } *@
@*                 if (numTickets < selectedSeats.length) { *@
@*                     selectedSeats = selectedSeats.slice(0, numTickets); *@
@*                     $('.seat').removeClass('selected'); *@
@*                     selectedSeats.forEach(s => $(`.seat[data-seat-id="${s.id}"]`).addClass('selected')); *@
@*                 } *@
@*                 $('#selectedSeatIds').val(selectedSeats.map(s => s.id).join(',')); *@
@*                 $('#selectedSeatCount').text(selectedSeats.length); *@
@*                 $('#selectedSeats').text(selectedSeats.map(s => s.number).join(', ')); *@
@*                 const total = selectedSeats.length * pricePerSeat; *@
@*                 $('#totalPrice').text(total.toLocaleString('vi-VN') + 'đ'); *@
@*                 $('#ticketPrice').text(total.toLocaleString('vi-VN')); *@
@*                 $('#finalTotalPrice').text(total.toLocaleString('vi-VN') + 'đ'); *@
@*             }); *@
@*         }); *@
@*     </script> *@
@*     <style> *@
@*         .seat-map { *@
@*             margin-bottom: 20px; *@
@*         } *@

@*         .seat-grid { *@
@*             max-width: 600px; *@
@*         } *@

@*         .seat-row { *@
@*             display: flex; *@
@*             gap: 10px; *@
@*             margin-bottom: 10px; *@
@*         } *@

@*         .seat { *@
@*             width: 50px; *@
@*             height: 50px; *@
@*             line-height: 50px; *@
@*             text-align: center; *@
@*             border: 1px solid #ccc; *@
@*             border-radius: 5px; *@
@*             cursor: pointer; *@
@*             font-size: 14px; *@
@*         } *@

@*             .seat.available { *@
@*                 background-color: #b3e5fc; *@
@*                 color: black; *@
@*             } *@

@*             .seat.booked { *@
@*                 background-color: #bdbdbd; *@
@*                 color: white; *@
@*                 cursor: not-allowed; *@
@*             } *@

@*             .seat.selected { *@
@*                 background-color: #ff9800; *@
@*                 color: white; *@
@*             } *@

@*             .seat.empty { *@
@*                 background-color: transparent; *@
@*                 border: none; *@
@*             } *@

@*             .seat.aisle { *@
@*                 background-color: transparent; *@
@*                 border: none; *@
@*                 width: 50px; *@
@*                 height: 50px; *@
@*             } *@

@*         .seat-legend-box { *@
@*             margin-top: 10px; *@
@*         } *@

@*         .seat-legend { *@
@*             display: inline-block; *@
@*             width: 20px; *@
@*             height: 20px; *@
@*             margin-right: 10px; *@
@*             vertical-align: middle; *@
@*         } *@

@*             .seat-legend.booked { *@
@*                 background-color: #bdbdbd; *@
@*             } *@

@*             .seat-legend.available { *@
@*                 background-color: #b3e5fc; *@
@*             } *@

@*             .seat-legend.selected { *@
@*                 background-color: #ff9800; *@
@*             } *@

@*         .card { *@
@*             border: 1px solid #ddd; *@
@*             border-radius: 8px; *@
@*         } *@

@*         .card-title { *@
@*             font-size: 1.25rem; *@
@*             font-weight: bold; *@
@*         } *@

@*         .card-body p { *@
@*             margin-bottom: 0.5rem; *@
@*         } *@
@*     </style> *@
@* } *@