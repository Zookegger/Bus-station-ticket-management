@model IEnumerable<Bus_Station_Ticket_Management.Models.Driver>

@{
	ViewData["Title"] = "Index";
	Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<h1 class="text-success fw-bold mb-4">Drivers List</h1>

<a asp-action="Create" class="btn btn-primary mb-3" role="button"><i class="fa fa-plus-circle"></i> Add New Driver</a>

<form asp-action="Index" method="get" class="mb-3">
	<div class="form-group input-group mb-2">
		<input type="text" class="form-control" value="@ViewBag.SearchString" name="searchString"
			placeholder="Search for drivers..." />
		<button type="submit" class="btn btn-outline-primary">Search <i class="fa fa-search"
				style="font-size: 18px"></i></button>
	</div>

	<div class="form-group input-group">
		<select title="Sort" class="form-control" name="sortBy" id="sortBy" onchange="this.form.submit()">
			<option value="" disabled selected>Sort By...</option>
			<optgroup label="Sort by Name">
				<option value="name_asc" selected="@(ViewBag.SortBy == "name_asc" ? "selected" : null)">Name Ascending ↑
				</option>
				<option value="name_desc" selected="@(ViewBag.SortBy == "name_desc" ? "selected" : null)">Name
					Descending ↓</option>
			</optgroup>
			<optgroup label="Sort by Email">
				<option value="email_asc" selected="@(ViewBag.SortBy == "email_asc" ? "selected" : null)">Email
					Ascending ↑</option>
				<option value="email_desc" selected="@(ViewBag.SortBy == "email_desc" ? "selected" : null)">Email
					Descending ↓</option>
			</optgroup>
			<optgroup label="Sort by License">
				<option value="license_asc" selected="@(ViewBag.SortBy == "license_asc" ? "selected" : null)">License
					Ascending ↑</option>
				<option value="license_desc" selected="@(ViewBag.SortBy == "license_desc" ? "selected" : null)">License
					Descending ↓</option>
			</optgroup>
		</select>

		<select class="form-control ms-2" name="filterByGender" id="filterByGender" onchange="this.form.submit()">
			<option value="" disabled selected>Filter By Gender</option>
			<option value="Male" selected="@(ViewBag.FilterByGender == "Male" ? "selected" : null)">Male</option>
			<option value="Female" selected="@(ViewBag.FilterByGender == "Female" ? "selected" : null)">Female</option>
			<option value="Other" selected="@(ViewBag.FilterByGender == "Other" ? "selected" : null)">Other</option>
		</select>
	</div>
</form>
<div class="table-responsive mb-3 shadow rounded">
	<table id="DriversTable" class="table table-hover table-striped align-middle mb-0">
		<thead class="align-middle">
			<tr>
				<th style="min-width: 200px;">FullName</th>
				<th style="min-width: 250px;">Address</th>
				<th style="min-width: 150px;">Drivers License</th>
				<th style="min-width: 100px;">Gender</th>
				<th>DateOfBirth</th>
				<th>Email</th>
				<th>Phone Number</th>
				<th style="width: 30px">Actions</th>
			</tr>
		</thead>
		<tbody class="table-group=divider">
			@foreach (var item in Model)
			{
				<tr class="clickable-row" data-href="@Url.Action("Details", new { id = item.Id })">
					<td>
						@Html.DisplayFor(modelItem => item.FullName)
					</td>
					<td>
						@Html.DisplayFor(modelItem => item.Address)
					</td>
					<td>
						@Html.DisplayFor(modelItem => item.LicenseId)
					</td>
					<td>
						@Html.DisplayFor(modelItem => item.Gender)
					</td>
					<td>
						@Html.DisplayFor(modelItem => item.DateOfBirth)
					</td>
					<td style="max-width: 328px; word-wrap: break-word; white-space: normal;">
						@Html.DisplayFor(modelItem => item.Email)
					</td>
					<td>
						@Html.DisplayFor(modelItem => item.PhoneNumber)
					</td>
					<td class="px-1 py-1 text-center" onclick="event.stopPropagation()"> @* Problem: Stuck inside .table-responsive's layer -> Solution: Make it escape the .table-responsive *@
						<div class="dropdown" data-bs-theme="dark">
							<button class="btn btn-outline-secondary dropdown-toggle px-2 py-1" type="button"
								data-bs-toggle="dropdown" data-tippy-content="More Actions">
								<i class="fa fa-ellipsis-v"></i>
							</button>
							<ul class="dropdown-menu dropdown-menu-end shadow">
								<li>
									<a class="dropdown-item d-flex align-items-center gap-2" asp-action="Edit"
										asp-route-id="@item.Id">
										<i class="fa fa-edit text-primary"></i> Edit
									</a>
								</li>
								<li>
									<a class="dropdown-item d-flex align-items-center gap-2" asp-action="Delete"
										asp-route-id="@item.Id">
										<i class="fa fa-trash text-danger"></i> Delete
									</a>
								</li>
							</ul>
						</div>
					</td>
                </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts {
    <link rel="stylesheet" href="~/css/Index.css">
    <script src="~/js/table.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            $('#DriversTable').DataTable({
                // Current settings
                ordering: true, // Enables column ordering
                paging: true, // Enables pagination
                searching: true, // Enables search functionality
                info: true, // Displays table information
                filter: true, // Enables filtering (alias for searching)
                responsive: false, // Makes the table responsive
                columnDefs: [
                    {
                        targets: -1,  // Targets the last column (Actions column)
                        orderable: false  // Disables ordering on this column
                    }
                ],

                // Additional DataTable options
                autoWidth: true, // Automatically calculates column widths
                deferRender: true, // Improves performance for large datasets
                lengthChange: true, // Allows user to change the number of rows displayed
                lengthMenu: [10, 25, 50, 100], // Options for the number of rows per page
                pageLength: 10, // Default number of rows per page
                processing: true, // Displays a processing indicator
                scrollX: false, // Enables horizontal scrolling
                scrollY: '600px', // Enables vertical scrolling with a fixed height
                scrollCollapse: true,
                stateSave: false, // Saves the table state (pagination, search, etc.)
                language: { // Customizes language strings
                    search: "Search for Location:", // Custom search box placeholder
                    lengthMenu: "Show _MENU_ entries", // Custom length menu text
                    info: "_START_ to _END_ of _TOTAL_ entries", // Custom info text
                },
                dom: "<'row my-3 px-3' \
                                    <'col-12 col-sm-12 col-md-4 d-flex align-items-center justify-content-start px-0'l> \
                                    <'col-12 col-sm-10 col-md-7 d-flex align-items-center justify-content-sm-start justify-content-start px-0 pe-md-2'f> \
                                    <'col-12 col-sm-2 col-md-1 d-flex align-items-center justify-content-end px-0 ps-md-2'B> \
                                >" +
                    "<'px-3'rt>" +
                    "<'row px-3 py-3'" +
                    "<'col-md-6'i>" +
                    "<'col-md-6'p>" +
                    ">"
                ,  // B = buttons, f = filter, r = processing, t = table, i = info, p = pagination
                buttons: [
                    {
                        extend: 'collection',
                        text: '<i class="fa fa-ellipsis-h"></i>',
                        className: 'btn btn-outline-secondary',
                        attr: {
                            'data-tippy-content': 'More actions'
                        },
                        buttons: [
                            {
                                extend: 'copy',
                                text: 'Copy',
                                attr: { 'data-tippy-content': 'Copy table data' }
                            },
                            {
                                extend: 'csv',
                                text: 'CSV',
                                attr: { 'data-tippy-content': 'Export to CSV' }
                            },
                            {
                                extend: 'excel',
                                text: 'Excel',
                                attr: { 'data-tippy-content': 'Export to Excel' }
                            },
                            {
                                extend: 'pdf',
                                text: 'PDF',
                                attr: { 'data-tippy-content': 'Export to PDF' }
                            },
                            {
                                extend: 'print',
                                text: 'Print',
                                attr: { 'data-tippy-content': 'Print table data' }
                            }
                        ],
                    }
                ],
                ajax: null, // Loads data via AJAX
                columns: null, // Defines column data sources
                order: [[0, 'asc']], // Default column ordering
                rowCallback: null, // Callback for row creation
                initComplete: function () {
                    // Find the collection button and fix its classes
                    $('.buttons-collection')
                        .removeClass('btn-secondary') // remove default solid styling
                        .addClass('btn-outline-secondary'); // ensure outline is applied

                    tippy('[data-tippy-content]', {
                        placement: 'top',
                        theme: 'light'
                    });

                    // Re-initialize Tippy every time the collection dropdown is shown
                    $(document).on('click', '.buttons-collection', function () {
                        // Timeout allows the dropdown to render its DOM
                        setTimeout(function () {
                            tippy('[data-tippy-content]', {
                                placement: 'top',
                                theme: 'light',
                                delay: [100, 0]
                            });
                        }, 10);
                    });
                }
            });

            tippy('[data-tippy-content]', {
                placement: 'top',
                theme: 'light'
            });
        });
    </script>
}